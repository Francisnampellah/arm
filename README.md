# AR Marker Management System

AR.js + A-Frame demo served with Express, integrated with Strapi CMS for marker management.

## Quick Start

### Method 1: Docker Compose (Recommended)

This method runs all services (PostgreSQL, Strapi CMS, and the app) in containers:

```bash
# Build and start all services
docker compose up -d --build

# View logs
docker compose logs -f

# Stop all services
docker compose down
```

**Access Points:**
- **Main App**: http://localhost:3001
- **Strapi Admin Panel**: http://localhost:1337/admin
- **Strapi API**: http://localhost:1337/api

**First Time Setup:**
1. Access Strapi admin at http://localhost:1337/admin
2. Create an admin account
3. Follow the Strapi setup instructions in `STRAPI_SETUP.md` to create the content type
4. Create and publish marker mappings in Strapi

### Method 2: Local Development

**Prerequisites:**
- Node.js 20+ and npm
- PostgreSQL 16+ (or use Docker for just the database)
- TypeScript compiler

**Steps:**

1. **Install dependencies:**
   ```bash
   npm install
   ```

2. **Compile TypeScript:**
   ```bash
   npm run build
   ```

3. **Set up environment variables:**
   Create a `.env` file in the project root:
   ```env
   PORT=3000
   DATABASE_URL=postgresql://arm:arm_pass@localhost:5432/arm?schema=public
   STRAPI_URL=http://localhost:1337
   STRAPI_CONTENT_TYPE=markers
   STRAPI_API_TOKEN=your-api-token-here
   ```

4. **Start PostgreSQL** (if not using Docker):
   ```bash
   # Using Docker for just the database
   docker compose up -d postgres
   ```

5. **Start Strapi** (if not using Docker):
   ```bash
   # Using Docker for Strapi
   docker compose up -d strapi strapi-db
   ```
   Or run Strapi manually following their documentation.

6. **Run the application:**
   ```bash
   npm start
   # or
   npm run dev
   ```

7. **Access the app:**
   - Main app: http://localhost:3000
   - Strapi: http://localhost:1337/admin

## Project Structure

- `src/` - TypeScript source files
- `dist/` - Compiled JavaScript (generated by `npm run build`)
- `view/` - Frontend HTML/AR.js files
- `markers/` - AR marker patterns and images
- `docker-compose.yml` - Docker services configuration
- `STRAPI_SETUP.md` - Detailed Strapi CMS setup instructions

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `PORT` | Server port | `3000` |
| `DATABASE_URL` | PostgreSQL connection string | - |
| `STRAPI_URL` | Strapi CMS base URL | - |
| `STRAPI_API_TOKEN` | Strapi API authentication token | - |
| `STRAPI_CONTENT_TYPE` | Strapi content type name | `markers` |

## API Endpoints

- `GET /` - Serves the main AR view
- `GET /api/mappings` - List active marker mappings
- `POST /api/admin/markers` - Create a new marker mapping
- `PUT /api/admin/markers/:markerId` - Update a marker mapping
- `DELETE /api/admin/markers/:markerId` - Delete a marker mapping

## Development

**Rebuild after TypeScript changes:**
```bash
npm run build
```

**Watch mode (requires ts-node or similar):**
```bash
# Install ts-node-dev for watch mode
npm install --save-dev ts-node-dev

# Add to package.json scripts:
# "dev:watch": "ts-node-dev --respawn src/server.ts"
```

## Troubleshooting

- **Port already in use**: Change the `PORT` in `.env` or `docker-compose.yml`
- **Strapi not connecting**: Verify `STRAPI_URL` and ensure Strapi is running
- **Markers not loading**: Check that the `markers/` directory exists and is accessible
- **TypeScript errors**: Run `npm run build` to see compilation errors

## Additional Documentation

See `STRAPI_SETUP.md` for detailed instructions on setting up Strapi CMS content types and managing marker mappings.
